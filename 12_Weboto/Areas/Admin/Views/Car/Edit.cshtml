@model _12_Weboto.Models.Car

@{
    ViewData["Title"] = "Chỉnh sửa xe";
}

<h2 class="mb-4">🚗 Chỉnh sửa xe</h2>

<form asp-action="Edit" method="post" enctype="multipart/form-data">
    <input type="hidden" name="id" value="@Model.Id" />

    <!-- Tổng quan -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">Tổng quan</div>
        <div class="card-body row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="TenXe" class="form-label">Tên xe:</label>
                    <input type="text" class="form-control" name="TenXe" id="TenXe" value="@Model.TenXe" required />
                </div>

                <div class="form-group">
                    <label for="GiaTien" class="form-label">Giá tiền:</label>
                    <input type="number" class="form-control" name="GiaTien" id="GiaTien" value="@Model.GiaTien" required />
                </div>
                <select asp-for="BrandId" class="form-control" asp-items="ViewBag.HangXeList" required>
                    <option value="">-- Chọn hãng xe --</option>
                </select>

                <div class="form-group">
                    <label for="PhienBan" class="form-label">Phiên bản:</label>
                    <input type="text" class="form-control" name="PhienBan" id="PhienBan" value="@Model.PhienBan" required />
                </div>
                <div class="form-group">
                    <label for="SoChoNgoi" class="form-label">Số chỗ ngồi:</label>
                    <input type="number" class="form-control" name="SoChoNgoi" id="SoChoNgoi" value="@Model.SoChoNgoi" required />
                </div>
                <div class="form-group">
                    <label for="KieuDang" class="form-label">Kiểu dáng:</label>
                    <input type="text" class="form-control" name="KieuDang" id="KieuDang" value="@Model.KieuDang" required />
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="XuatXu" class="form-label">Xuất xứ:</label>
                    <input type="text" class="form-control" name="XuatXu" id="XuatXu" value="@Model.XuatXu" required />
                </div>
                <div class="form-group">
                    <label for="DongXe" class="form-label">Dòng xe:</label>
                    <input type="text" class="form-control" name="DongXe" id="DongXe" value="@Model.DongXe" required />
                </div>
                <div class="form-group">
                    <label for="NamSanXuat" class="form-label">Năm sản xuất:</label>
                    <input type="number" class="form-control" name="NamSanXuat" id="NamSanXuat" value="@Model.NamSanXuat" required />
                </div>
                <div class="form-group">
                    <label for="SoKM" class="form-label">Số KM đã đi:</label>
                    <input type="number" class="form-control" name="SoKM" id="SoKM" value="@Model.SoKM" required />
                </div>
                <div class="form-group">
                    <label for="NhienLieu" class="form-label">Nhiên liệu:</label>
                    <input type="text" class="form-control" name="NhienLieu" id="NhienLieu" value="@Model.NhienLieu" required />
                </div>
            </div>
        </div>
    </div>

    <!-- Động cơ & Hiệu suất -->
    <div class="card mb-4">
        <div class="card-header bg-secondary text-white">Động cơ & Hiệu suất</div>
        <div class="card-body row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="DongCo" class="form-label">Động cơ:</label>
                    <input type="text" class="form-control" name="DongCo" id="DongCo" value="@Model.DongCo" required />
                </div>
                <div class="form-group">
                    <label for="HopSo" class="form-label">Hộp số:</label>
                    <input type="text" class="form-control" name="HopSo" id="HopSo" value="@Model.HopSo" required />
                </div>
            </div>
        </div>
    </div>

    <!-- Kích thước & Trọng lượng -->
    <div class="card mb-4">
        <div class="card-header bg-success text-white">Kích thước & Trọng lượng</div>
        <div class="card-body row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="ChieuDai" class="form-label">Chiều dài (mm):</label>
                    <input type="number" class="form-control" name="ChieuDai" id="ChieuDai" value="@Model.ChieuDai" required />
                </div>
                <div class="form-group">
                    <label for="ChieuRong" class="form-label">Chiều rộng (mm):</label>
                    <input type="number" class="form-control" name="ChieuRong" id="ChieuRong" value="@Model.ChieuRong" required />
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="ChieuCao" class="form-label">Chiều cao (mm):</label>
                    <input type="number" class="form-control" name="ChieuCao" id="ChieuCao" value="@Model.ChieuCao" required />
                </div>
                <div class="form-group">
                    <label for="CoSoBanhXe" class="form-label">Cơ sở bánh xe:</label>
                    <input type="number" class="form-control" name="CoSoBanhXe" id="CoSoBanhXe" value="@Model.CoSoBanhXe" required />
                </div>
                <div class="form-group">
                    <label for="TrongLuongKhongTai" class="form-label">Trọng lượng không tải:</label>
                    <input type="number" class="form-control" name="TrongLuongKhongTai" id="TrongLuongKhongTai" value="@Model.TrongLuongKhongTai" required />
                </div>
            </div>
        </div>
    </div>

    <!-- Mâm & Lốp xe -->
    <div class="card mb-4">
        <div class="card-header bg-warning text-white">Mâm & Lốp xe</div>
        <div class="card-body row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="LopTruoc" class="form-label">Lốp trước:</label>
                    <input type="text" class="form-control" name="LopTruoc" id="LopTruoc" value="@Model.LopTruoc" required />
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="LopSau" class="form-label">Lốp sau:</label>
                    <input type="text" class="form-control" name="LopSau" id="LopSau" value="@Model.LopSau" required />
                </div>
            </div>
        </div>
    </div>

    <!-- Mức tiêu thụ nhiên liệu -->
    <div class="card mb-4">
        <div class="card-header bg-danger text-white">Mức tiêu thụ nhiên liệu</div>
        <div class="card-body row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="MucTieuThuNgoaiDoThi" class="form-label">Mức tiêu thụ ngoài đô thị (L/100km):</label>
                    <input type="number" step="0.1" class="form-control" name="MucTieuThuNgoaiDoThi" id="MucTieuThuNgoaiDoThi" value="@Model.MucTieuThuNgoaiDoThi" required />
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="MucTieuThuTrongDoThi" class="form-label">Mức tiêu thụ trong đô thị (L/100km):</label>
                    <input type="number" step="0.1" class="form-control" name="MucTieuThuTrongDoThi" id="MucTieuThuTrongDoThi" value="@Model.MucTieuThuTrongDoThi" required />
                </div>
            </div>
        </div>
    </div>

    <div class="form-group">
        <label for="MoTa" class="form-label">Mô tả:</label>
        <textarea class="form-control" name="MoTa" id="MoTa" required>@Model.MoTa</textarea>
    </div>

    <h4 class="mt-4">📷 Ảnh xe</h4>
    <div class="row">
        @if (Model.Images != null && Model.Images.Any())
        {
            @foreach (var image in Model.Images)
            {
                <div class="col-md-3 text-center mb-3">
                    <img src="@image.ImageUrl" alt="Car Image" class="img-thumbnail rounded" style="width: 100%;" />
                    <br />
                    <input type="checkbox" name="DeletedImageIds" value="@image.Id" /> Xóa ảnh
                </div>
            }
        }
        else
        {
            <p>Không có ảnh nào.</p>
        }
    </div>

    <h4 class="mt-4">📷 Thêm ảnh mới</h4>
    <input type="file" name="NewImages" multiple class="form-control" />

    <div class="row mt-3" id="previewContainer"></div>

    <br />
    <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Lưu</button>
    <a asp-action="Index" class="btn btn-secondary"><i class="fas fa-times"></i> Hủy</a>
</form>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const fileInput = document.querySelector("input[name='NewImages']");
        const previewContainer = document.getElementById("previewContainer");

        fileInput.addEventListener("change", function (event) {
            previewContainer.innerHTML = ""; // Xóa ảnh cũ trước khi thêm mới
            const files = event.target.files;

            if (files.length > 0) {
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];

                    if (file && file.type.startsWith("image/")) {
                        const reader = new FileReader();

                        reader.onload = function (e) {
                            const img = document.createElement("img");
                            img.src = e.target.result;
                            img.classList.add("img-thumbnail", "rounded", "m-2");
                            img.style.width = "150px";
                            previewContainer.appendChild(img);
                        };

                        reader.readAsDataURL(file);
                    }
                }
            }
        });
    });
</script>




